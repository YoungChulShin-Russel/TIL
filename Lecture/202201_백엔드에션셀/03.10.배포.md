# 대규모 서비스 설계를 위한 백엔드 에센셜
## 배포
Rolling Update
- 방법
   1. 4대가 동작하고 있다고 가정하면 1대를 LB에서 제거
   2. 1대를 신규 버전으로 변경
   3. 신규 버전으로 변경한 1대를 LB의 타켓그룹으로 다시 추가
   4. 1-3 과정을 모든 서버가 변경될 때까지 반복

Blue/Green 배포
- 배포 시간이 오래 걸릴 경우 고려
- 구조
   ```
   Client <-> LB <-> Version1 / Version2 <-> DB
   ```
- Version1과 Version2가 모두 존재하는 시점에 LB에서 Routing 설정을 변경하는 방식으로 배포
   - Version1과 Version2는 같은 수가 존재한다
- 장애가 나면 Routing을 바꿔서 빠른 Rollback이 가능하다
- Cloud에서는 쉽지만, OnPremise는 구현이 번거롭다

Canary 배포
- Blue/Green으로 할 때 배포에 영향을 받는 대상이 너무 많다고 생각될 경우 검토해볼 수 있는 방법
- 개념: 몇대만 배포를 해 보는 것
- 어떻게 특정 유저를 특정 서버로 고정할 수 있을지에 대한 고민이 필요하다
   - 예: 유저에 tag를 등록해서 리다이렉션 하는 방법 등