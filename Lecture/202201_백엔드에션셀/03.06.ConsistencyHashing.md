# 대규모 서비스 설계를 위한 백엔드 에센셜
## Consistency Hashing
개념
- 샤딩을 사용하면서 서버의 추가/삭제 시 rebalancing이 적게 일어나도록 하는 개념
- 같은 hash를 사용하면 항상 같은 결과를 보여줘야한다
- rule이 있어야한다
   - 예: hash key 보다 크면서 가장 가까운 hash 값을 가진 서버에 자신의 데이터를 저장한다.

rebalancing이 적게 일어나는 이유
- 특정 서버가 죽어서 rebalancing이 발생했을 때, 해당 서버에 있는 데이터만 영향을 받기 때문이다. 

스톨 데이터
- A, B, C가 CH을 구성중일 때, B가 죽으면 B에 들어가는 데이터가 C로 들어가게 된다
- 이 상태에서 B가 다시 살아나면 데이터는 B에 들어가게 되고, 
- C에 있는 데이터는 스톨 데이터라고 한다

부하에는 안정적이지 않다
- A, B, C가 CH을 구성중일 때, B가 죽으면 C에 B, C의 요청이 몰리기 때문에 안정적이지 않다
- Virtual Node
   - A, B, C안에 더 잘게 여러 노드를 나누어서 부하를 분산되도록 하는 방법

서버의 이름은 유니크해야한다
- IP는 장비 교체 등의 이유로 변경될 수 있다. 이로 인해서 hash ring이 변경될 수 있다
- nick name을 이용하도록 한다