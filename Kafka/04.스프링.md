# 스프링
스프링에서 카프카를 사용하기 위한 방법
1. 카프카 클라이언트를 이용해서 Java 기반으로 코드 작성
2. spring-kafka를 이용해서 조금 더 추상화된 개념으로 코드 작성
3. spring-cloud를 이용해서 더 추상화된 개념으로 작성
   - spring-cloud를 이용하면 binder 정보를 변경해서 kafka, kinesis 등을 변경할 수 있다

# 프로듀서
KafkaTemplate을 이용해서 메시지를 전달할 수 있다. 
```java
private final KafkaTemplate<String, String> kafkaTemplate;
kafkaTemplate.send(topicName, "test-" + i);
```

기본 템플릿은 바로 의존성을 주입받아서 사용할 수 있고, 개별 설정이 필요하다면 빈을 정의하면 된다. 

커스텀 템플릿은 Java 기반에서 코드를 작성하는 것과 거의 동일하다. 
```java
@Bean
public KafkaTemplate<String, String> customKafkaTemplate() {
   Map<String, Object> props = new HashMap<>();
   props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
   props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());
   props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());

   DefaultKafkaProducerFactory<String, String> pf = new DefaultKafkaProducerFactory<>(props);

   return new KafkaTemplate<>(pf);
}
```

전달 콜백
- KafkaTemplate.send()의 응답은 ListenableFuture이다. 
- callback을 추가해서 전달의 성공/실패 여부를 확인할 수 있다
   ```java
   ListenableFuture<SendResult<String, String>> ack = template.send(TOPIC_NAME, "test" + i);
   ack.addCallback(new ListenableFutureCallback<SendResult<String, String>>() {
      @Override
      public void onFailure(Throwable ex) {
         System.out.println("Send-Fail: " + ex.getMessage());
      }

      @Override
      public void onSuccess(SendResult<String, String> result) {
         System.out.println("Send-Success: " + result.getProducerRecord().value());
      }
   });
   ```

# 컨슈머 
커밋
- Java 구현에서는 오토 커밋, 동기 커밋, 비동기 커밋 3가지였지만 스프링 카프카는 더 많은 항목을 지원한다
- 종류
   - RECORD: 레코드 단위로 프로세싱 이후 커밋
   - BATCH(기본): poll() 호출된 레코드가 모두 처리된 이후에 커밋
   - TIME: 특정 시간 이후에 커밋
   - COUNT: 특정 갯수 이후에 커밋
   - COUNT_TIME: TIME, COUNT 옵션 중 하나라도 만족하면 커밋
   - MANUAL: Acknowledgement.acknowledge() 메서드가 호출되면 다음 poll() 때 커밋
   - MANUAL_IMMEDIATE: Acknowledgement.acknowledge() 메서드가 호출되면 즉시 커밋

Application 설정은 공식 홈페이지를 참고한다
- https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html

